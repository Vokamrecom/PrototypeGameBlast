window.__require=function e(t,o,i){function n(a,s){if(!o[a]){if(!t[a]){var l=a.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+a+"'")}a=l}var p=o[a]={exports:{}};t[a][0].call(p.exports,function(e){return n(t[a][1][e]||e)},p,p.exports,e,t,o,i)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"67b3cIkXa9EiJSNk4saLtMY","GameConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=void 0;var i=function(){function e(){}return e.calculateScore=function(e){return e*e*10},e.FIELD_WIDTH=8,e.FIELD_HEIGHT=8,e.TARGET_SCORE=1e3,e.MAX_MOVES=30,e.TILE_SIZE=60,e.TILE_SPACING=3,e}();o.GameConfig=i,cc._RF.pop()},{}],GameController:[function(e,t,o){"use strict";cc._RF.push(t,"ec372QV67BLQKkb8MotQzVS","GameController");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.GameController=void 0;var a=e("../managers/GameManager"),s=e("../views/GameFieldView"),l=e("../views/UIManager"),c=cc._decorator,p=c.ccclass,u=c.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameFieldView=null,t.uiManager=null,t}return n(t,e),t.prototype.onLoad=function(){this.gameManager=a.GameManager.getInstance(),this.gameManager&&(this.setupEventListeners(),this.startGame())},t.prototype.setupEventListeners=function(){var e=this;this.gameManager&&(this.gameManager.on("gameStarted",function(){return e.onGameStarted()},this),this.gameManager.on("scoreChanged",function(t){return e.onScoreChanged(t)},this),this.gameManager.on("tilesBurned",function(t){return e.onTilesBurned(t)},this),this.gameManager.on("gravityApplied",function(){return e.onGravityApplied()},this),this.gameManager.on("tilesFilled",function(){return e.onTilesFilled()},this),this.gameManager.on("gameWon",function(){return e.onGameWon()},this),this.gameManager.on("gameLost",function(t){return e.onGameLost(t)},this),this.uiManager&&this.uiManager.node&&this.uiManager.node.on("restartGame",this.startGame,this))},t.prototype.startGame=function(){this.gameManager&&this.gameManager.startNewGame()},t.prototype.onGameStarted=function(){var e=this,t=this.gameManager.getTileManager();this.gameFieldView&&this.gameFieldView.init(t,function(t,o){e.gameManager.onTileClick(t,o)}),this.uiManager&&(this.uiManager.init(),this.uiManager.updateScore(this.gameManager.getScore()),this.uiManager.updateMoves(this.gameManager.getRemainingMoves()))},t.prototype.onScoreChanged=function(e){this.uiManager&&(this.uiManager.updateScore(e),this.uiManager.updateMoves(this.gameManager.getRemainingMoves()))},t.prototype.onTilesBurned=function(e){var t=this;this.gameFieldView&&this.gameFieldView.playBurnAnimation(e,function(){t.gameFieldView.refreshField()})},t.prototype.onGravityApplied=function(){var e=this;this.gameFieldView&&(this.gameFieldView.refreshField(),this.scheduleOnce(function(){e.gameFieldView.playFallAnimation(function(){e.gameFieldView.refreshField()})},.1))},t.prototype.onTilesFilled=function(){this.gameFieldView&&this.gameFieldView.updateAfterFill()},t.prototype.onGameWon=function(){this.uiManager&&this.uiManager.showWinPanel(this.gameManager.getScore())},t.prototype.onGameLost=function(e){this.uiManager&&this.uiManager.showLosePanel(e)},t.prototype.onDestroy=function(){this.gameManager.off("gameStarted",this.onGameStarted,this),this.gameManager.off("scoreChanged",this.onScoreChanged,this),this.gameManager.off("tilesBurned",this.onTilesBurned,this),this.gameManager.off("gravityApplied",this.onGravityApplied,this),this.gameManager.off("tilesFilled",this.onTilesFilled,this),this.gameManager.off("gameWon",this.onGameWon,this),this.gameManager.off("gameLost",this.onGameLost,this)},r([u(s.GameFieldView)],t.prototype,"gameFieldView",void 0),r([u(l.UIManager)],t.prototype,"uiManager",void 0),r([p],t)}(cc.Component);o.GameController=f,cc._RF.pop()},{"../managers/GameManager":"GameManager","../views/GameFieldView":"GameFieldView","../views/UIManager":"UIManager"}],GameFieldView:[function(e,t,o){"use strict";cc._RF.push(t,"f84c8mN4CtCd7JJ0m2jai66","GameFieldView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.GameFieldView=void 0;var a=e("./TileView"),s=e("../models/GameConfig"),l=e("../utils/ResourceLoader"),c=cc._decorator,p=c.ccclass,u=c.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.backgroundSprite=null,t.tileViews=[],t.tileManager=null,t.onClickCallback=null,t}return n(t,e),t.prototype.init=function(e,t){var o=this;this.tileManager=e,this.onClickCallback=t,a.TileView.preloadTileFrames(function(){o.loadBackground(),o.createField()})},t.prototype.loadBackground=function(){var e=this;if(this.backgroundSprite){var t=l.ResourceLoader.getBackgroundPath("frame_play");t&&l.ResourceLoader.loadSpriteFrame(t,function(t){if(t&&e.backgroundSprite&&e.backgroundSprite.node){e.backgroundSprite.spriteFrame=t;var o=s.GameConfig.FIELD_WIDTH*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)-s.GameConfig.TILE_SPACING,i=s.GameConfig.FIELD_HEIGHT*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)-s.GameConfig.TILE_SPACING;e.backgroundSprite.node.setContentSize(o+40,i+40),e.backgroundSprite.node.setPosition(0,0),e.backgroundSprite.node.setSiblingIndex(0)}})}},t.prototype.createField=function(){this.clearField(),this.tileViews=[];for(var e=this.tileManager.getField(),t=0;t<s.GameConfig.FIELD_HEIGHT;t++){this.tileViews[t]=[];for(var o=0;o<s.GameConfig.FIELD_WIDTH;o++){var i=e[t][o];i&&this.createTileView(i,t,o)}}},t.prototype.clearField=function(){for(var e=this.node.children.slice(),t=0;t<e.length;t++)e[t].destroy();for(var o=0;o<s.GameConfig.FIELD_HEIGHT;o++)for(var i=0;i<s.GameConfig.FIELD_WIDTH;i++){var n=this.tileViews[o]?this.tileViews[o][i]:null;n&&n.node&&cc.isValid(n.node)&&n.node.destroy()}this.tileViews=[]},t.prototype.createTileView=function(e,t,o){var i,n,r=this;if(!this.tilePrefab)return(i=new cc.Node("Tile")).setContentSize(s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE),void this.setupSimpleTile(i,e,t,o,null);try{n=(i=cc.instantiate(this.tilePrefab)).getComponent(a.TileView),i.setContentSize(s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE);var l=i.getComponent(cc.Sprite);if(l?n&&!n.sprite&&(n.sprite=l):(l=i.addComponent(cc.Sprite),n&&l&&(n.sprite=l)),l&&(l.type=cc.Sprite.Type.SIMPLE,l.sizeMode=cc.Sprite.SizeMode.CUSTOM),l&&!l.spriteFrame){var c=e.type;if(a.TileView.loadedFrames&&a.TileView.loadedFrames[c])l.spriteFrame=a.TileView.loadedFrames[c];else{var p=this.getColorForTileType(e.type);i.color=p}}}catch(d){return}this.node.addChild(i),0!==i.getContentSize().width&&0!==i.getContentSize().height||i.setContentSize(s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE);var u=i.getComponent(cc.Sprite);if(u&&(u.type=cc.Sprite.Type.SIMPLE,u.sizeMode=cc.Sprite.SizeMode.CUSTOM,!u.spriteFrame)&&(c=e.type,a.TileView.loadedFrames&&a.TileView.loadedFrames[c]?u.spriteFrame=a.TileView.loadedFrames[c]:(p=this.getColorForTileType(e.type),i.color=p)),n)n.init(e,this.onClickCallback),n.updateNodePosition(t,o),this.tileViews[t][o]=n,u||console.error("[ERROR] TileView initialized but no Sprite component found for tile at "+t+", "+o);else{var f={node:i,tile:e,currentRow:t,currentCol:o,updateNodePosition:function(e,t){f.currentRow=e,f.currentCol=t;var o=-s.GameConfig.FIELD_WIDTH*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)/2,n=s.GameConfig.FIELD_HEIGHT*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)/2,r=o+t*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)+s.GameConfig.TILE_SIZE/2,a=n-e*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)-s.GameConfig.TILE_SIZE/2;i.setPosition(r,a)},updateVisual:function(){if(u&&e){var t=e.type;if(a.TileView.loadedFrames&&a.TileView.loadedFrames[t])u.spriteFrame=a.TileView.loadedFrames[t];else{var o=r.getColorForTileType(e.type);i.color=o}}},playBurnAnimation:function(e){var t=cc.scaleTo(.1,1.2),o=cc.scaleTo(.1,0),n=cc.fadeOut(.2),r=cc.spawn(o,n),a=e?cc.callFunc(e):null;a?i.runAction(cc.sequence(t,r,a)):i.runAction(cc.sequence(t,r))},playFallAnimation:function(e,t,o){var n=cc.moveTo(t,i.x,e),r=o?cc.callFunc(o):null;r?i.runAction(cc.sequence(n,r)):i.runAction(n)}};this.onClickCallback&&i.on(cc.Node.EventType.TOUCH_END,function(){console.log("[TEMP_CLICK] TempTileView clicked, using stored position ("+f.currentRow+", "+f.currentCol+")"),r.onClickCallback(f.currentRow,f.currentCol)}),this.tileViews[t][o]=f,f.updateNodePosition(t,o),this.addTileEffects(i)}},t.prototype.setupSimpleTile=function(e,t,o,i){var n=this;e.setContentSize(s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE);var r=s.GameConfig.FIELD_WIDTH*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING),l=s.GameConfig.FIELD_HEIGHT*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING),c=-r/2+s.GameConfig.TILE_SIZE/2,p=l/2-s.GameConfig.TILE_SIZE/2,u=c+i*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING),f=p-o*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING);e.setPosition(u,f);var d=this.getColorForTileType(t.type);e.color=d,e.on(cc.Node.EventType.TOUCH_END,function(){n.onClickCallback&&n.onClickCallback(o,i)});var g=e.getComponent(cc.Sprite);if(!g)try{if(!(g=e.addComponent(cc.Sprite)))return}catch(y){return}if(g&&(g.type=cc.Sprite.Type.SIMPLE,g.sizeMode=cc.Sprite.SizeMode.CUSTOM),g){var m=t.type;if(a.TileView.loadedFrames&&a.TileView.loadedFrames[m])g.spriteFrame=a.TileView.loadedFrames[m];else if(!g.spriteFrame)try{var h=document.createElement("canvas");h.width=s.GameConfig.TILE_SIZE,h.height=s.GameConfig.TILE_SIZE;var T=h.getContext("2d");T.fillStyle="#FFFFFF",T.fillRect(0,0,s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE);var C=new cc.Texture2D;C.initWithElement(h),C.handleLoadedTexture();var v=new cc.SpriteFrame;v.setTexture(C),v.setRect(cc.rect(0,0,s.GameConfig.TILE_SIZE,s.GameConfig.TILE_SIZE)),g.spriteFrame=v}catch(y){}e.color=d,g.enabled=!0,e.active=!0,this.node.addChild(e)}},t.prototype.getColorForTileType=function(e){return[cc.Color.RED,cc.Color.GREEN,cc.Color.BLUE,cc.Color.YELLOW,new cc.Color(128,0,128),new cc.Color(255,165,0)][e]||cc.Color.WHITE},t.prototype.addTileEffects=function(e){e.setScale(.95),e.opacity=0;var t=cc.fadeIn(.2),o=cc.scaleTo(.2,1);e.runAction(cc.spawn(t,o))},t.prototype.refreshField=function(){if(this.tileManager){for(var e=this.tileManager.getField(),t=new Map,o=0;o<s.GameConfig.FIELD_HEIGHT;o++)if(this.tileViews[o])for(var i=0;i<s.GameConfig.FIELD_WIDTH;i++)(m=this.tileViews[o][i])&&m.tile&&t.set(m.tile,m);var n=[];for(o=0;o<s.GameConfig.FIELD_HEIGHT;o++)for(n[o]=[],i=0;i<s.GameConfig.FIELD_WIDTH;i++)n[o][i]=null;for(o=0;o<s.GameConfig.FIELD_HEIGHT;o++)for(i=0;i<s.GameConfig.FIELD_WIDTH;i++)if(g=e[o][i]){g.row===o&&g.col===i||g.updatePosition(o,i);var r=t.get(g);if(r&&r.node&&cc.isValid(r.node)){if(r.updatePosition?r.updatePosition(o,i):r.updateNodePosition&&(r.updateNodePosition(o,i),void 0!==r.currentRow&&(r.currentRow=o,r.currentCol=i)),r.updateVisual)r.updateVisual();else{var l=r.node.getComponent(cc.Sprite);if(l&&g){var c=g.type;if(a.TileView.loadedFrames&&a.TileView.loadedFrames[c])l.spriteFrame=a.TileView.loadedFrames[c];else{var p=this.getColorForTileType(g.type);r.node.color=p}}}r.tile=g,n[o][i]=r}else this.createTileView(g,o,i),n[o][i]=this.tileViews[o]?this.tileViews[o][i]:null}else n[o][i]=null;for(var u=0,f=t.entries();u<f.length;u++){var d=f[u],g=d[0],m=d[1],h=!1;for(o=0;o<s.GameConfig.FIELD_HEIGHT;o++){for(i=0;i<s.GameConfig.FIELD_WIDTH;i++)if(n[o][i]===m){h=!0;break}if(h)break}!h&&m&&m.node&&cc.isValid(m.node)&&m.node.destroy()}this.tileViews=n}else console.warn("[REFRESH] No tileManager, cannot refresh field")},t.prototype.playBurnAnimation=function(e,t){var o=0,i=e.length;if(0!==i)for(var n=0,r=e;n<r.length;n++){for(var a=r[n],l=null,c=0;c<s.GameConfig.FIELD_HEIGHT;c++)if(this.tileViews[c]){for(var p=0;p<s.GameConfig.FIELD_WIDTH;p++){var u=this.tileViews[c][p];if(u&&u.tile===a){l=u;break}}if(l)break}l&&l.playBurnAnimation?l.playBurnAnimation(function(){++o===i&&t&&t()}):++o===i&&t&&t()}else t&&t()},t.prototype.playFallAnimation=function(e){if(this.tileManager){for(var t=this.tileManager.getField(),o=0,i=0,n=0;n<s.GameConfig.FIELD_HEIGHT;n++)for(var r=0;r<s.GameConfig.FIELD_WIDTH;r++){var a=t[n][r],l=this.tileViews[n]?this.tileViews[n][r]:null;if(a&&l){var c=this.calculateYPosition(n),p=l.node.y;Math.abs(c-p)>1&&o++}}if(0!==o)for(n=0;n<s.GameConfig.FIELD_HEIGHT;n++)for(r=0;r<s.GameConfig.FIELD_WIDTH;r++)a=t[n][r],l=this.tileViews[n]?this.tileViews[n][r]:null,a&&l&&(c=this.calculateYPosition(n),p=l.node.y,Math.abs(c-p)>1&&l.playFallAnimation(c,.3,function(){++i===o&&e&&e()}));else e&&e()}else e&&e()},t.prototype.calculateYPosition=function(e){return s.GameConfig.FIELD_HEIGHT*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)/2-e*(s.GameConfig.TILE_SIZE+s.GameConfig.TILE_SPACING)-s.GameConfig.TILE_SIZE/2},t.prototype.updateAfterFill=function(){var e=this;this.scheduleOnce(function(){e.refreshField()},.1)},r([u(cc.Prefab)],t.prototype,"tilePrefab",void 0),r([u(cc.Sprite)],t.prototype,"backgroundSprite",void 0),r([p],t)}(cc.Component);o.GameFieldView=f,cc._RF.pop()},{"../models/GameConfig":"GameConfig","../utils/ResourceLoader":"ResourceLoader","./TileView":"TileView"}],GameManager:[function(e,t,o){"use strict";cc._RF.push(t,"60e7c3/Vp1I7obuBY7B27J7","GameManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameManager=void 0;var i=e("./TileManager"),n=e("../models/GameConfig"),r=e("../models/GameState"),a=function(){function e(){this.score=0,this.moves=0,this.state=r.GameState.MENU,this.isProcessing=!1,this.eventListeners={},this.tileManager=new i.TileManager}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.startNewGame=function(){this.tileManager=new i.TileManager,this.score=0,this.moves=0,this.state=r.GameState.PLAYING,this.isProcessing=!1,this.emit("gameStarted")},e.prototype.onTileClick=function(e,t){if(this.state!==r.GameState.PLAYING||this.isProcessing)console.log("[CLICK] Ignored: state="+this.state+", isProcessing="+this.isProcessing);else{var o=this.tileManager.findConnectedTiles(e,t);console.log("[CLICK] Clicked at ("+e+", "+t+"), found "+o.length+" connected tiles"),o.length<2?console.log("[CLICK] Not enough tiles (need 2, found "+o.length+")"):(console.log("[CLICK] Processing burn of "+o.length+" tiles"),this.isProcessing=!0,this.processTileBurn(o))}},e.prototype.processTileBurn=function(e){var t=this;this.moves++,this.tileManager.removeTiles(e);var o=n.GameConfig.calculateScore(e.length);this.score+=o,this.emit("scoreChanged",this.score),this.emit("tilesBurned",e),setTimeout(function(){t.applyGravityAndFill()},500)},e.prototype.applyGravityAndFill=function(){var e=this;this.tileManager.applyGravity(),this.emit("gravityApplied"),setTimeout(function(){e.tileManager.fillEmptyCells(),e.emit("tilesFilled"),e.checkGameConditions()},300)},e.prototype.checkGameConditions=function(){return this.score>=n.GameConfig.TARGET_SCORE?(this.state=r.GameState.WIN,this.emit("gameWon"),void(this.isProcessing=!1)):this.moves>=n.GameConfig.MAX_MOVES?(this.state=r.GameState.LOSE,this.emit("gameLost","\u0417\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0438\u0441\u044c \u0445\u043e\u0434\u044b!"),void(this.isProcessing=!1)):this.tileManager.hasPossibleMoves()?void(this.isProcessing=!1):(this.state=r.GameState.LOSE,this.emit("gameLost","\u041d\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0445 \u0445\u043e\u0434\u043e\u0432!"),void(this.isProcessing=!1))},e.prototype.getScore=function(){return this.score},e.prototype.getRemainingMoves=function(){return Math.max(0,n.GameConfig.MAX_MOVES-this.moves)},e.prototype.getState=function(){return this.state},e.prototype.getTileManager=function(){return this.tileManager},e.prototype.on=function(e,t){this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.off=function(e,t){if(this.eventListeners[e]){var o=this.eventListeners[e].indexOf(t);o>-1&&this.eventListeners[e].splice(o,1)}},e.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.eventListeners[e]&&this.eventListeners[e].forEach(function(e){return e.apply(void 0,t)})},e}();o.GameManager=a,cc._RF.pop()},{"../models/GameConfig":"GameConfig","../models/GameState":"GameState","./TileManager":"TileManager"}],GameState:[function(e,t,o){"use strict";cc._RF.push(t,"64613sNBg1BrZHwDpj76E1f","GameState"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=void 0,function(e){e.MENU="menu",e.PLAYING="playing",e.WIN="win",e.LOSE="lose",e.PAUSED="paused"}(o.GameState||(o.GameState={})),cc._RF.pop()},{}],ResourceLoader:[function(e,t,o){"use strict";cc._RF.push(t,"738e38DXkJPZpDrO9mPIR5I","ResourceLoader"),Object.defineProperty(o,"__esModule",{value:!0}),o.ResourceLoader=void 0;var i=function(){function e(){}return e.loadSpriteFrame=function(e,t){var o=this;"undefined"!=typeof cc&&cc.resources&&"function"==typeof cc.resources.load?cc.resources.load(e,cc.SpriteFrame,function(i,n){i?o.tryAssetManagerLoad(e,t):t(n)}):this.tryAssetManagerLoad(e,t)},e.tryAssetManagerLoad=function(e,t){if("undefined"!=typeof cc&&cc.assetManager&&cc.assetManager.resources){var o=cc.assetManager.resources;if(o&&"function"==typeof o.load)try{o.load(e,cc.SpriteFrame,function(e,o){t(e?null:o)})}catch(i){t(null)}else t(null)}else t(null)},e.loadSpriteFrames=function(e,t){var o=this,i=[],n=0,r=e.length;0!==r?e.forEach(function(e,a){o.loadSpriteFrame(e,function(e){i[a]=e,++n===r&&t(i)})}):t([])},e.getTileSpritePath=function(e){var t=["maket/block_red","maket/block_green","maket/block_blue","maket/block_yellow","maket/block_purpure","maket/block_yellow"];return t[e]||t[0]},e.getTileSpritePaths=function(){return["maket/block_red","maket/block_green","maket/block_blue","maket/block_yellow","maket/block_purpure","maket/block_yellow"]},e.getBackgroundPath=function(e){return{booster:"maket/bg_booster",frame_moves:"maket/bg_frame_moves",frame_play:"maket/bg_frame_play",moves:"maket/bg_moves",slot_booster:"maket/slot_booster",slot_frame_moves:"maket/slot_frame_moves"}[e]||""},e}();o.ResourceLoader=i,cc._RF.pop()},{}],TileManager:[function(e,t,o){"use strict";cc._RF.push(t,"51692/yDhREVKQv8ZDPrWzA","TileManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileManager=void 0;var i=e("../models/Tile"),n=e("../models/TileType"),r=e("../models/GameConfig"),a=function(){function e(){this.field=[],this.initializeField()}return e.prototype.initializeField=function(){this.field=[];for(var e=0;e<r.GameConfig.FIELD_HEIGHT;e++){this.field[e]=[];for(var t=0;t<r.GameConfig.FIELD_WIDTH;t++)this.field[e][t]=new i.Tile(n.getRandomTileType(),e,t)}},e.prototype.getTile=function(e,t){return this.isValidPosition(e,t)?this.field[e][t]:null},e.prototype.setTile=function(e,t,o){this.isValidPosition(e,t)&&(this.field[e][t]=o,o&&o.updatePosition(e,t))},e.prototype.isValidPosition=function(e,t){return e>=0&&e<r.GameConfig.FIELD_HEIGHT&&t>=0&&t<r.GameConfig.FIELD_WIDTH},e.prototype.getField=function(){return this.field},e.prototype.findConnectedTiles=function(e,t){var o=this.getTile(e,t);if(!o)return console.log("[BFS] No tile at ("+e+", "+t+")"),[];var i=o.type;console.log("[BFS] Starting from ("+e+", "+t+"), type: "+i);for(var n=new Set,a=[],s=[],l=0;l<r.GameConfig.FIELD_HEIGHT;l++){a[l]=[];for(var c=0;c<r.GameConfig.FIELD_WIDTH;c++)a[l][c]=!1}for(s.push({row:e,col:t}),a[e][t]=!0;s.length>0;){var p=s.shift(),u=this.getTile(p.row,p.col);if(u)if(u.type===i){n.add(u),console.log("[BFS] Added tile at ("+p.row+", "+p.col+"), type: "+u.type+", total: "+n.size);for(var f=0,d=[{row:p.row-1,col:p.col},{row:p.row+1,col:p.col},{row:p.row,col:p.col-1},{row:p.row,col:p.col+1}];f<d.length;f++){var g=d[f];if(this.isValidPosition(g.row,g.col)&&!a[g.row][g.col]){a[g.row][g.col]=!0;var m=this.getTile(g.row,g.col);m&&m.type===i&&(console.log("[BFS] Found connected neighbor at ("+g.row+", "+g.col+"), type: "+m.type),s.push({row:g.row,col:g.col}))}}}else console.log("[BFS] Tile at ("+p.row+", "+p.col+") has different type: "+u.type+" vs "+i);else console.log("[BFS] No tile at ("+p.row+", "+p.col+")")}var h=Array.from(n);return console.log("[BFS] Search completed. Found "+h.length+" connected tiles"),h},e.prototype.removeTiles=function(e){for(var t=0,o=e;t<o.length;t++){var i=o[t];if(this.getTile(i.row,i.col)===i)this.setTile(i.row,i.col,null);else for(var n=!1,a=0;a<r.GameConfig.FIELD_HEIGHT;a++){for(var s=0;s<r.GameConfig.FIELD_WIDTH;s++)if(this.getTile(a,s)===i){this.setTile(a,s,null),n=!0;break}if(n)break}}},e.prototype.applyGravity=function(){for(var e=0;e<r.GameConfig.FIELD_WIDTH;e++)for(var t=r.GameConfig.FIELD_HEIGHT-1,o=r.GameConfig.FIELD_HEIGHT-1;o>=0;o--){var i=this.getTile(o,e);i&&(t!==o?(this.field[o][e]=null,this.setTile(t,e,i)):i.row===t&&i.col===e||i.updatePosition(t,e),t--)}},e.prototype.fillEmptyCells=function(){for(var e=0;e<r.GameConfig.FIELD_HEIGHT;e++)for(var t=0;t<r.GameConfig.FIELD_WIDTH;t++)if(null===this.getTile(e,t)){var o=new i.Tile(n.getRandomTileType(),e,t);this.setTile(e,t,o)}},e.prototype.hasPossibleMoves=function(){for(var e=0;e<r.GameConfig.FIELD_HEIGHT;e++)for(var t=0;t<r.GameConfig.FIELD_WIDTH;t++)if(this.findConnectedTiles(e,t).length>=2)return!0;return!1},e}();o.TileManager=a,cc._RF.pop()},{"../models/GameConfig":"GameConfig","../models/Tile":"Tile","../models/TileType":"TileType"}],TileType:[function(e,t,o){"use strict";var i;cc._RF.push(t,"bfebc08VaxHDpoe8kr+qaYU","TileType"),Object.defineProperty(o,"__esModule",{value:!0}),o.getRandomTileType=o.TileType=void 0,function(e){e[e.RED=0]="RED",e[e.GREEN=1]="GREEN",e[e.BLUE=2]="BLUE",e[e.YELLOW=3]="YELLOW",e[e.PURPLE=4]="PURPLE",e[e.ORANGE=5]="ORANGE"}(i=o.TileType||(o.TileType={})),o.getRandomTileType=function(){var e=Object.values(i).filter(function(e){return"number"==typeof e});return e[Math.floor(Math.random()*e.length)]},cc._RF.pop()},{}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"8e8744g5z5I5b1IpSnwIVjx","TileView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.TileView=void 0;var a=e("../models/GameConfig"),s=e("../utils/ResourceLoader"),l=cc._decorator,c=l.ccclass,p=l.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprite=null,t.tileFrames=[],t.tile=null,t.onClickCallback=null,t.currentRow=-1,t.currentCol=-1,t}var o;return n(t,e),o=t,t.preloadTileFrames=function(e){var t=this;if(this.framesLoaded)e&&e();else{var o=s.ResourceLoader.getTileSpritePaths();s.ResourceLoader.loadSpriteFrames(o,function(o){t.loadedFrames=o,t.framesLoaded=!0,e&&e()})}},t.prototype.init=function(e,t){this.tile=e,this.currentRow=e.row,this.currentCol=e.col,this.onClickCallback=t,this.updateVisual(),this.setupClickHandler(),this.addAppearAnimation()},t.prototype.addAppearAnimation=function(){this.node.setScale(.95),this.node.opacity=0;var e=cc.fadeIn(.2),t=cc.scaleTo(.2,1);this.node.runAction(cc.spawn(e,t))},t.prototype.updateVisual=function(){var e=this;if(this.tile&&this.sprite){var t=this.tile.type;if(o.loadedFrames[t])return void(this.sprite.spriteFrame=o.loadedFrames[t]);if(this.tileFrames&&this.tileFrames[t])return void(this.sprite.spriteFrame=this.tileFrames[t]);var i=s.ResourceLoader.getTileSpritePath(t);s.ResourceLoader.loadSpriteFrame(i,function(t){t&&e.sprite?e.sprite.spriteFrame=t:e.sprite&&(e.sprite.node.color=e.getColorForType(e.tile.type))})}},t.prototype.getColorForType=function(e){return[cc.Color.RED,cc.Color.GREEN,cc.Color.BLUE,cc.Color.YELLOW,new cc.Color(128,0,128),new cc.Color(255,165,0)][e]||cc.Color.WHITE},t.prototype.setupClickHandler=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTileClick,this)},t.prototype.onTileClick=function(){var e,t;this.onClickCallback&&this.currentRow>=0&&this.currentCol>=0&&(console.log("[TILE_CLICK] TileView clicked at stored position ("+this.currentRow+", "+this.currentCol+"), tile position ("+(null===(e=this.tile)||void 0===e?void 0:e.row)+", "+(null===(t=this.tile)||void 0===t?void 0:t.col)+")"),this.onClickCallback(this.currentRow,this.currentCol))},t.prototype.playBurnAnimation=function(e){var t=cc.scaleTo(.1,1.2),o=cc.scaleTo(.1,0),i=cc.fadeOut(.2),n=cc.spawn(o,i),r=cc.callFunc(function(){e&&e()});this.node.runAction(cc.sequence(t,n,r))},t.prototype.playFallAnimation=function(e,t,o){var i=cc.moveTo(t,this.node.x,e),n=o?cc.callFunc(o):null;n?this.node.runAction(cc.sequence(i,n)):this.node.runAction(i)},t.prototype.updatePosition=function(e,t){this.tile&&this.tile.updatePosition(e,t),this.updateNodePosition(e,t)},t.prototype.updateNodePosition=function(e,t){var o=-a.GameConfig.FIELD_WIDTH*(a.GameConfig.TILE_SIZE+a.GameConfig.TILE_SPACING)/2,i=a.GameConfig.FIELD_HEIGHT*(a.GameConfig.TILE_SIZE+a.GameConfig.TILE_SPACING)/2,n=o+t*(a.GameConfig.TILE_SIZE+a.GameConfig.TILE_SPACING)+a.GameConfig.TILE_SIZE/2,r=i-e*(a.GameConfig.TILE_SIZE+a.GameConfig.TILE_SPACING)-a.GameConfig.TILE_SIZE/2;this.node.setPosition(n,r)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.onTileClick,this)},t.loadedFrames=[],t.framesLoaded=!1,r([p(cc.Sprite)],t.prototype,"sprite",void 0),r([p([cc.SpriteFrame])],t.prototype,"tileFrames",void 0),o=r([c],t)}(cc.Component);o.TileView=u,cc._RF.pop()},{"../models/GameConfig":"GameConfig","../utils/ResourceLoader":"ResourceLoader"}],Tile:[function(e,t,o){"use strict";cc._RF.push(t,"376b2+wVnBEsYzZAo8mlrql","Tile"),Object.defineProperty(o,"__esModule",{value:!0}),o.Tile=void 0;var i=function(){function e(e,t,o){this.node=null,this.type=e,this.row=t,this.col=o}return e.prototype.isSameType=function(e){return null!==e&&this.type===e.type},e.prototype.updatePosition=function(e,t){this.row=e,this.col=t},e}();o.Tile=i,cc._RF.pop()},{}],UIManager:[function(e,t,o){"use strict";cc._RF.push(t,"e3672xj04FAgIbPesXCLApM","UIManager");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.UIManager=void 0;var a=e("../models/GameConfig"),s=e("../utils/ResourceLoader"),l=cc._decorator,c=l.ccclass,p=l.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scoreLabel=null,t.movesLabel=null,t.targetScoreLabel=null,t.winPanel=null,t.losePanel=null,t.winScoreLabel=null,t.loseMessageLabel=null,t.restartButton=null,t.movesFrameSprite=null,t.scoreFrameSprite=null,t}return n(t,e),t.prototype.init=function(){this.targetScoreLabel&&(this.targetScoreLabel.string="\u0426\u0435\u043b\u044c: "+a.GameConfig.TARGET_SCORE),this.updateScore(0),this.updateMoves(a.GameConfig.MAX_MOVES),this.hidePanels(),this.loadBackgrounds()},t.prototype.loadBackgrounds=function(){var e,t=this;this.movesFrameSprite&&(e=s.ResourceLoader.getBackgroundPath("frame_moves"))&&s.ResourceLoader.loadSpriteFrame(e,function(e){e&&t.movesFrameSprite&&(t.movesFrameSprite.spriteFrame=e)}),this.scoreFrameSprite&&(e=s.ResourceLoader.getBackgroundPath("frame_moves"))&&s.ResourceLoader.loadSpriteFrame(e,function(e){e&&t.scoreFrameSprite&&(t.scoreFrameSprite.spriteFrame=e)})},t.prototype.updateScore=function(e){this.scoreLabel&&(this.scoreLabel.string="\u041e\u0447\u043a\u0438: "+e)},t.prototype.updateMoves=function(e){this.movesLabel&&(this.movesLabel.string="\u0425\u043e\u0434\u044b: "+e)},t.prototype.showWinPanel=function(e){this.winPanel&&(this.winPanel.active=!0),this.winScoreLabel&&(this.winScoreLabel.string="\u0412\u044b \u043d\u0430\u0431\u0440\u0430\u043b\u0438 "+e+" \u043e\u0447\u043a\u043e\u0432!")},t.prototype.showLosePanel=function(e){this.losePanel&&(this.losePanel.active=!0),this.loseMessageLabel&&(this.loseMessageLabel.string=e)},t.prototype.hidePanels=function(){this.winPanel&&(this.winPanel.active=!1),this.losePanel&&(this.losePanel.active=!1)},t.prototype.onRestartClick=function(){this.hidePanels(),this.node&&this.node.emit("restartGame")},r([p(cc.Label)],t.prototype,"scoreLabel",void 0),r([p(cc.Label)],t.prototype,"movesLabel",void 0),r([p(cc.Label)],t.prototype,"targetScoreLabel",void 0),r([p(cc.Node)],t.prototype,"winPanel",void 0),r([p(cc.Node)],t.prototype,"losePanel",void 0),r([p(cc.Label)],t.prototype,"winScoreLabel",void 0),r([p(cc.Label)],t.prototype,"loseMessageLabel",void 0),r([p(cc.Button)],t.prototype,"restartButton",void 0),r([p(cc.Sprite)],t.prototype,"movesFrameSprite",void 0),r([p(cc.Sprite)],t.prototype,"scoreFrameSprite",void 0),r([c],t)}(cc.Component);o.UIManager=u,cc._RF.pop()},{"../models/GameConfig":"GameConfig","../utils/ResourceLoader":"ResourceLoader"}],"use_v2.0.x_cc.Toggle_event":[function(e,t){"use strict";cc._RF.push(t,"9ed1fE8SqVNlYn1Cvg+4ykc","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["use_v2.0.x_cc.Toggle_event","GameController","GameManager","TileManager","GameConfig","GameState","Tile","TileType","ResourceLoader","GameFieldView","TileView","UIManager"]);